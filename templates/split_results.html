<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å‰²çµæœ | PDF åˆ†å‰²å·¥å…·</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>PDF åˆ†å‰²å·¥å…·</h1>
            <p>åˆ†å‰²å®Œæˆ</p>
        </header>
        
        <!-- Flash è¨Šæ¯é¡¯ç¤ºå€åŸŸ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            <span class="flash-text">{{ message }}</span>
                            <button type="button" class="flash-close" onclick="this.parentElement.remove()">&times;</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <main>
            <!-- åˆ†å‰²æˆåŠŸè¨Šæ¯ -->
            <div class="success-summary">
                <div class="success-icon">âœ…</div>
                <h2>PDF åˆ†å‰²æˆåŠŸï¼</h2>
                <p>æ‚¨çš„ PDF æª”æ¡ˆå·²æˆåŠŸåˆ†å‰²ç‚º {{ split_result.total_parts }} å€‹æª”æ¡ˆ</p>
            </div>
            
            <!-- åˆ†å‰²æ‘˜è¦ -->
            <div class="split-summary-card">
                <h3>åˆ†å‰²æ‘˜è¦</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="summary-label">åŸå§‹æª”æ¡ˆï¼š</span>
                        <span class="summary-value">{{ split_result.original_info.filename }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">åŸå§‹é æ•¸ï¼š</span>
                        <span class="summary-value">{{ split_result.original_info.total_pages }} é </span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">åŸå§‹æª”æ¡ˆå¤§å°ï¼š</span>
                        <span class="summary-value">{{ split_result.original_info.size_mb }} MB</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">åˆ†å‰²æª”æ¡ˆæ•¸é‡ï¼š</span>
                        <span class="summary-value">{{ split_result.total_parts }} å€‹æª”æ¡ˆ</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ç¸½è¼¸å‡ºå¤§å°ï¼š</span>
                        <span class="summary-value">{{ "%.2f"|format(split_result.split_summary.total_output_size / 1024 / 1024) }} MB</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">è™•ç†æ™‚é–“ï¼š</span>
                        <span class="summary-value">{{ "%.2f"|format(split_result.processing_time) }} ç§’</span>
                    </div>
                </div>
            </div>
            
            <!-- æ‰¹é‡ä¸‹è¼‰å€åŸŸ -->
            <div class="download-actions">
                <h3>ä¸‹è¼‰é¸é …</h3>
                <div class="action-buttons">
                    {% if zip_result and zip_result.success %}
                    <!-- ZIP ä¸‹è¼‰å¯ç”¨ -->
                    <button type="button" class="btn btn-primary btn-large" onclick="downloadZipFile()">
                        <span class="btn-icon">ğŸ“¦</span>
                        ä¸‹è¼‰å…¨éƒ¨æª”æ¡ˆ (ZIP - {{ zip_result.zip_size_mb }} MB)
                    </button>
                    <div class="zip-info">
                        <small>âœ… ZIP æª”æ¡ˆå·²æº–å‚™å°±ç·’ï¼ŒåŒ…å« {{ zip_result.total_files }} å€‹æª”æ¡ˆï¼Œå£“ç¸®ç‡ {{ zip_result.compression_ratio }}%</small>
                    </div>
                    {% elif zip_result %}
                    <!-- ZIP å‰µå»ºå¤±æ•— -->
                    <button type="button" class="btn btn-secondary btn-large" disabled>
                        <span class="btn-icon">âŒ</span>
                        ZIP æª”æ¡ˆå‰µå»ºå¤±æ•—
                    </button>
                    <div class="zip-info">
                        <small>âš ï¸ ç„¡æ³•å‰µå»º ZIP æª”æ¡ˆï¼Œè«‹ä½¿ç”¨ä¸‹æ–¹çš„å€‹åˆ¥æª”æ¡ˆä¸‹è¼‰</small>
                    </div>
                    {% else %}
                    <!-- ZIP åŠŸèƒ½ä¸å¯ç”¨ -->
                    <button type="button" class="btn btn-secondary btn-large" disabled>
                        <span class="btn-icon">ğŸ“¦</span>
                        ZIP ä¸‹è¼‰ä¸å¯ç”¨
                    </button>
                    <div class="zip-info">
                        <small>âš ï¸ ZIP åŠŸèƒ½æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ä½¿ç”¨ä¸‹æ–¹çš„å€‹åˆ¥æª”æ¡ˆä¸‹è¼‰</small>
                    </div>
                    {% endif %}
                    
                    <button type="button" class="btn btn-secondary" data-redirect="{{ url_for('index') }}">
                        <span class="btn-icon">ğŸ”„</span>
                        è™•ç†æ–°æª”æ¡ˆ
                    </button>
                </div>
                
                {% if zip_result and zip_result.success %}
                <!-- ZIP æª”æ¡ˆè©³æƒ… -->
                <div class="zip-details">
                    <h4>ZIP æª”æ¡ˆè³‡è¨Š</h4>
                    <div class="zip-summary">
                        <div class="zip-stat">
                            <span class="stat-label">æª”æ¡ˆåç¨±ï¼š</span>
                            <span class="stat-value">{{ zip_result.zip_filename }}</span>
                        </div>
                        <div class="zip-stat">
                            <span class="stat-label">æª”æ¡ˆå¤§å°ï¼š</span>
                            <span class="stat-value">{{ zip_result.zip_size_mb }} MB</span>
                        </div>
                        <div class="zip-stat">
                            <span class="stat-label">åŒ…å«æª”æ¡ˆï¼š</span>
                            <span class="stat-value">{{ zip_result.total_files }} å€‹ PDF</span>
                        </div>
                        <div class="zip-stat">
                            <span class="stat-label">åŸå§‹å¤§å°ï¼š</span>
                            <span class="stat-value">{{ zip_result.original_size_mb }} MB</span>
                        </div>
                        <div class="zip-stat">
                            <span class="stat-label">å£“ç¸®æ•ˆæœï¼š</span>
                            <span class="stat-value">ç¯€çœ {{ zip_result.compression_ratio }}%</span>
                        </div>
                        <div class="zip-stat">
                            <span class="stat-label">è™•ç†æ™‚é–“ï¼š</span>
                            <span class="stat-value">{{ "%.2f"|format(zip_result.processing_time) }} ç§’</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- åˆ†å‰²æª”æ¡ˆåˆ—è¡¨ -->
            <div class="split-files-section">
                <h3>åˆ†å‰²æª”æ¡ˆè©³æƒ…</h3>
                <div class="files-list">
                    {% for file in split_result.split_files %}
                    <div class="file-item">
                        <div class="file-info">
                            <div class="file-header">
                                <h4 class="file-name">{{ file.filename }}</h4>
                                <span class="file-index">#{{ file.index }}</span>
                            </div>
                            <div class="file-details">
                                <div class="detail-item">
                                    <span class="detail-label">é é¢ç¯„åœï¼š</span>
                                    <span class="detail-value">
                                        {% if file.start_page == file.end_page %}
                                            ç¬¬ {{ file.start_page }} é 
                                        {% else %}
                                            ç¬¬ {{ file.start_page }}-{{ file.end_page }} é 
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">é æ•¸ï¼š</span>
                                    <span class="detail-value">{{ file.page_count }} é </span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">æª”æ¡ˆå¤§å°ï¼š</span>
                                    <span class="detail-value">{{ file.size_mb }} MB</span>
                                </div>
                            </div>
                        </div>
                        <div class="file-actions">
                            <button type="button" class="btn btn-download" data-file-index="{{ file.index }}">
                                <span class="btn-icon">â¬‡ï¸</span>
                                ä¸‹è¼‰
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- æ‰€é¸æ›¸ç±¤è³‡è¨Š -->
            {% if selected_bookmarks %}
            <div class="selected-bookmarks-section">
                <h3>ä½¿ç”¨çš„åˆ†å‰²é»</h3>
                <div class="bookmarks-grid">
                    {% for bookmark in selected_bookmarks %}
                    <div class="bookmark-item">
                        <span class="bookmark-page">ç¬¬ {{ bookmark.page_num }} é </span>
                        <span class="bookmark-title">{{ bookmark.title }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </main>
        
        <footer>
            <p>&copy; 2024 PDF åˆ†å‰²å·¥å…·</p>
        </footer>
    </div>
    
    <script>
        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„è™•ç†
        document.addEventListener('DOMContentLoaded', function() {
            console.log('åˆ†å‰²çµæœé é¢å·²è¼‰å…¥');
            
            // è¨­å®šäº‹ä»¶å§”æ´¾è™•ç†æ‰€æœ‰æŒ‰éˆ•é»æ“Š
            setupEventDelegation();
            
            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
            showInfo('PDF åˆ†å‰²å®Œæˆï¼æ‚¨å¯ä»¥ä¸‹è¼‰å€‹åˆ¥æª”æ¡ˆæˆ– ZIP æ‰“åŒ…æª”æ¡ˆã€‚');
        });
        
        // è¨­å®šäº‹ä»¶å§”æ´¾
        function setupEventDelegation() {
            document.addEventListener('click', function(e) {
                // è™•ç†æª”æ¡ˆä¸‹è¼‰æŒ‰éˆ•
                if (e.target.closest('.btn-download')) {
                    const button = e.target.closest('.btn-download');
                    const fileIndex = button.getAttribute('data-file-index');
                    if (fileIndex) {
                        downloadFile(fileIndex);
                    }
                }
                
                // è™•ç†é‡å®šå‘æŒ‰éˆ•
                if (e.target.closest('[data-redirect]')) {
                    const button = e.target.closest('[data-redirect]');
                    const redirectUrl = button.getAttribute('data-redirect');
                    if (redirectUrl) {
                        window.location.href = redirectUrl;
                    }
                }
            });
        }
        
        // ä¸‹è¼‰å–®å€‹æª”æ¡ˆ
        function downloadFile(fileIndex) {
            showInfo('æ­£åœ¨æº–å‚™ä¸‹è¼‰æª”æ¡ˆ ' + fileIndex + '...');
            var baseUrl = '{{ url_for("download_file", file_index=1) }}';
            window.location.href = baseUrl.replace('1', fileIndex);
        }
        
        // ä¸‹è¼‰ ZIP æª”æ¡ˆ
        function downloadZipFile() {
            showInfo('æ­£åœ¨æº–å‚™ ZIP ä¸‹è¼‰...');
            window.location.href = '{{ url_for("download_zip") }}';
        }
        
        // é¡¯ç¤ºè³‡è¨Šè¨Šæ¯
        function showInfo(message) {
            var flashContainer = document.querySelector('.flash-messages') || createFlashContainer();
            var infoDiv = document.createElement('div');
            infoDiv.className = 'flash-message flash-info';
            infoDiv.innerHTML = 
                '<span class="flash-text">' + message + '</span>' +
                '<button type="button" class="flash-close" onclick="this.parentElement.remove()">&times;</button>';
            
            flashContainer.appendChild(infoDiv);
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(function() {
                if (infoDiv.parentElement) {
                    infoDiv.remove();
                }
            }, 3000);
        }
        
        // å‰µå»º Flash è¨Šæ¯å®¹å™¨
        function createFlashContainer() {
            var header = document.querySelector('header');
            var main = document.querySelector('main');
            
            var flashContainer = document.createElement('div');
            flashContainer.className = 'flash-messages';
            
            if (header && main) {
                header.parentNode.insertBefore(flashContainer, main);
            } else {
                document.body.appendChild(flashContainer);
            }
            
            return flashContainer;
        }
    </script>
</body>
</html> 