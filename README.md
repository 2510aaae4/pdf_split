# PDF 分割工具

一個基於 Flask 的 Web 應用程式，可以根據書籤結構自動分割 PDF 檔案。

## 功能特點

### 🚀 核心功能
- **智能書籤識別**：自動解析 PDF 書籤並識別潛在的分割點
- **模式匹配**：支援多種書籤命名模式的自動識別
- **靈活分割**：允許用戶手動選擇書籤作為分割點
- **批量下載**：支援單檔下載和 ZIP 批量下載
- **現代化介面**：響應式設計，支援桌面和移動設備

### 🛡️ 系統特性
- **大檔案支援**：支援最大 500MB 的 PDF 檔案
- **臨時檔案管理**：自動清理過期的臨時檔案
- **錯誤處理**：完善的錯誤處理和用戶反饋
- **會話管理**：安全的會話檔案追蹤
- **日誌記錄**：詳細的操作日誌記錄

## 安裝指南

### 系統需求
- Python 3.7+
- pip（Python 包管理器）

### 安裝步驟

1. **克隆或下載專案**
   ```bash
   # 如果從 Git 克隆
   git clone <repository-url>
   cd pdf分割
   
   # 或直接下載並解壓到此目錄
   ```

2. **安裝依賴**
   ```bash
   pip install -r requirements.txt
   ```

3. **啟動應用程式**
   ```bash
   python app.py
   ```

4. **開啟瀏覽器**
   - 訪問：http://127.0.0.1:5000
   - 開始使用 PDF 分割功能

## 使用說明

### 基本流程

1. **上傳 PDF 檔案**
   - 在首頁選擇要分割的 PDF 檔案
   - 支援拖放上傳或點擊選擇
   - 檔案大小限制：500MB

2. **分析書籤結構**
   - 系統自動解析 PDF 書籤
   - 識別符合模式的書籤作為建議分割點
   - 顯示所有可用的書籤列表

3. **選擇分割點**
   - 查看系統建議的分割點
   - 手動勾選想要的書籤作為分割點
   - 可以預覽分割結果

4. **下載分割檔案**
   - 自動生成分割後的 PDF 檔案
   - 提供單檔下載或 ZIP 批量下載
   - 顯示分割統計和檔案資訊

### 支援的書籤模式

系統自動識別以下書籤命名模式：

1. **數字標題模式**：`1 Introduction`、`2 Background` 等
2. **階層式編號**：`1.1 Overview`、`2.3.4 Details` 等
3. **章節模式**：`Chapter 1`、`Part A`、`Section 2` 等

## 檔案結構

```
pdf分割/
├── app.py                 # Flask 主應用程式
├── bookmark_utils.py      # 書籤解析工具
├── pdf_splitter.py        # PDF 分割功能
├── zip_utils.py          # ZIP 壓縮功能
├── file_cleanup.py       # 檔案清理機制
├── requirements.txt       # Python 依賴
├── templates/            # HTML 模板
│   ├── index.html        # 首頁
│   ├── upload_success.html # 上傳成功頁
│   ├── select_bookmarks.html # 書籤選擇頁
│   ├── split_results.html # 分割結果頁
│   ├── 404.html          # 404 錯誤頁
│   ├── 413.html          # 檔案過大錯誤頁
│   └── 500.html          # 伺服器錯誤頁
├── static/               # 靜態資源
│   ├── css/
│   │   └── style.css     # 主要樣式
│   └── js/
│       └── main.js       # JavaScript 功能
└── logs/                 # 日誌檔案（自動創建）
```

## 技術規格

### 後端技術
- **框架**：Flask 2.3.3
- **PDF 處理**：PyPDF2 3.0.1
- **檔案處理**：Python tempfile 模組
- **日誌**：Python logging + RotatingFileHandler

### 前端技術
- **HTML5**：語義化標記
- **CSS3**：現代化樣式，支援響應式設計
- **JavaScript**：ES5 兼容，無需額外框架

### 主要依賴
```
Flask==2.3.3
PyPDF2==3.0.1
python-dotenv==1.0.0
Werkzeug==2.3.7
```

## 開發功能

### 調試端點（僅開發模式）
- `/cleanup-stats`：查看檔案清理統計
- `/force-cleanup`：強制清理過期檔案

### 日誌記錄
- 生產模式：檔案日誌（`logs/app.log`）
- 開發模式：控制台日誌 + 檔案日誌

### 檔案清理機制
- **自動清理**：每 30 分鐘清理過期檔案
- **會話清理**：會話結束時清理相關檔案
- **錯誤清理**：發生錯誤時自動清理臨時檔案

## 故障排除

### 常見問題

1. **模組導入錯誤**
   ```bash
   # 確認安裝所有依賴
   pip install -r requirements.txt
   ```

2. **檔案上傳失敗**
   - 檢查檔案大小是否超過 500MB
   - 確認檔案格式為 PDF
   - 檢查臨時目錄權限

3. **書籤解析失敗**
   - 確認 PDF 檔案包含書籤
   - 檢查 PDF 檔案是否損壞
   - 查看日誌檔案獲取詳細錯誤資訊

4. **分割失敗**
   - 確認選擇了有效的書籤分割點
   - 檢查 PDF 檔案權限
   - 查看臨時目錄空間是否足夠

### 日誌查看
```bash
# 查看最新日誌
tail -f logs/app.log

# 查看錯誤日誌
grep ERROR logs/app.log
```

## 安全考量

- **檔案隔離**：每個會話的檔案獨立存儲
- **自動清理**：臨時檔案定期清理
- **大小限制**：防止過大檔案攻擊
- **類型驗證**：僅允許 PDF 檔案上傳

## 效能最佳化

- **記憶體管理**：大檔案串流處理
- **臨時檔案**：智能清理機制
- **壓縮優化**：ZIP 檔案自動壓縮
- **錯誤處理**：優雅的異常處理

## 授權

此專案僅供學習和個人使用。

## 更新日誌

### v1.0.0 (2024-05-23)
- ✅ 完成核心 PDF 分割功能
- ✅ 實現書籤解析和過濾
- ✅ 添加 ZIP 批量下載功能
- ✅ 完善檔案清理機制
- ✅ 優化用戶介面和體驗
- ✅ 增強錯誤處理和日誌記錄

---

**開發完成時間**：2024年5月23日  
**版本**：MVP 1.0  
**狀態**：生產就緒 